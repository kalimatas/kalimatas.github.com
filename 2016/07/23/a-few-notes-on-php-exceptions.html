<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="/static/css/style.css" type="text/css" />
	<link rel="stylesheet" href="/static/css/pygments.css" type="text/css" />
	<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>A Few Notes on PHP Exceptions | Alexander Guz’s blog</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="A Few Notes on PHP Exceptions" />
<meta name="author" content="Alexander Guz" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="There are several practices, that I found myself using over and over again while working with PHP exceptions. Here they are." />
<meta property="og:description" content="There are several practices, that I found myself using over and over again while working with PHP exceptions. Here they are." />
<link rel="canonical" href="https://guzalexander.com/2016/07/23/a-few-notes-on-php-exceptions.html" />
<meta property="og:url" content="https://guzalexander.com/2016/07/23/a-few-notes-on-php-exceptions.html" />
<meta property="og:site_name" content="Alexander Guz’s blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-07-23T20:30:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="A Few Notes on PHP Exceptions" />
<meta name="twitter:site" content="@kalimatas" />
<meta name="twitter:creator" content="@Alexander Guz" />
<script type="application/ld+json">
{"headline":"A Few Notes on PHP Exceptions","dateModified":"2016-07-23T20:30:00+02:00","datePublished":"2016-07-23T20:30:00+02:00","url":"https://guzalexander.com/2016/07/23/a-few-notes-on-php-exceptions.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://guzalexander.com/2016/07/23/a-few-notes-on-php-exceptions.html"},"author":{"@type":"Person","name":"Alexander Guz"},"description":"There are several practices, that I found myself using over and over again while working with PHP exceptions. Here they are.","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>

	<section class="container">
		<nav class="menu">
			<ul>
				<li><a class="nav-link fancy-hover" href="/"><span>Home</span></a></li>
				<li><a class="nav-link fancy-hover" href="/archive/"><span>Archive</span></a></li>
				<li><a class="nav-link fancy-hover" href="/about/"><span>About</span></a></li>
			</ul>
			<ul>
				<li>
					<a class="nav-link fancy-hover" href="https://twitter.com/kalimatas" target="_blank" >
						<span>
							<img alt="Twitter" width="18" height="18" title="Twitter" src="/static/img/twitter_new.svg" />
						</span>
					</a>
				</li>
				<li>
					<a class="nav-link fancy-hover" href="https://github.com/kalimatas" target="_blank">
						<span>
							<img alt="GitHub" width="18" height="18" title="GitHub" src="/static/img/github_new.svg" />
						</span>
					</a>
				</li>
				<li>
					<a class="nav-link fancy-hover" href="https://linkedin.com/in/kalimatas" target="_blank" >
						<span>
							<img alt="LinkedIn" width="18" height="18" title="LinkedIn" src="/static/img/linkedin_new.svg" />
						</span>
					</a>
				</li>
			</ul>
		</nav>

		<section class="main-wrapper">
			<section class="main">
				<article>
	
	<h1><span>A Few Notes on PHP Exceptions</span></h1>
	<section class="post-meta">
		
		<time>July 23, 2016</time> • <span class="reading-time" title="Estimated read time">
  
  
    4 mins read
  
</span>

	</section>
	
	<section id="article-content">
		<p>There are several practices, that I found myself using over and over again while working with PHP exceptions. Here they are.</p>

<h4 id="packagecomponent-level-exception-interface">Package/component level exception interface</h4>

<p>Create an interface that represents the top level of exceptions hierarchy for your package/component/module. This interface is known as a <a href="https://en.wikipedia.org/wiki/Marker_interface_pattern">Marker interface</a>. This approach has several advantages. First, it allows clients of your code to distinguish these component specific exceptions from others. Second, as PHP doesn’t support multiple inheritance, using an interface allows the exceptions to extends from other exceptions. e.g. <a href="https://secure.php.net/manual/en/spl.exceptions.php">SPL exceptions</a>.</p>

<p>Here is an example wth usage:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="kn">namespace</span> <span class="nn">some\package</span> <span class="p">{</span>
    <span class="c1">// Common package level exception</span>
    <span class="kd">interface</span> <span class="nc">Exception</span> <span class="k">extends</span> <span class="err">\</span><span class="nc">Throwable</span> <span class="p">{}</span>

    <span class="kd">class</span> <span class="nc">InvalidArgumentException</span> <span class="k">extends</span> <span class="err">\</span><span class="nc">InvalidArgumentException</span>
        <span class="kd">implements</span> <span class="nc">Exception</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="n">namespace</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="c1">// Do something</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nc">some\package\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// All package specific exceptions</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nc">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Other exceptions</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<h4 id="factory-methods-to-create-exceptions">Factory methods to create exceptions</h4>

<p>It is quite often, that exception’s message is long and contains some placeholders. Generating this message, especially if you throw it in different places, is not very convenient. In this case a factory method will hide this complexity. Imaging, you are doing something like this:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="kd">interface</span> <span class="nc">SomeInterface</span> <span class="p">{}</span>
<span class="nv">$c</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">stdClass</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$c</span> <span class="k">instanceof</span> <span class="nc">SomeInterface</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nc">some\package\UnexpectedValueException</span><span class="p">(</span>
        <span class="nb">sprintf</span><span class="p">(</span><span class="s1">'Argument is of type "%s", but expecting "%s"'</span><span class="p">,</span> <span class="nb">get_class</span><span class="p">(</span><span class="nv">$c</span><span class="p">),</span> <span class="nc">SomeInterface</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
    <span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>But instead, it would me much more cleaner to do this:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="kd">class</span> <span class="nc">UnexpectedValueException</span> <span class="k">extends</span> <span class="err">\</span><span class="nc">UnexpectedValueException</span>
    <span class="kd">implements</span> <span class="nc">Exception</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="n">wrongType</span><span class="p">(</span><span class="nv">$given</span><span class="p">,</span> <span class="nv">$expected</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">self</span><span class="p">(</span>
            <span class="nb">sprintf</span><span class="p">(</span><span class="s1">'Argument is of type "%s", but expecting "%s"'</span><span class="p">,</span> <span class="nv">$given</span><span class="p">,</span> <span class="nv">$expected</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Calling code</span>
<span class="kn">use</span> <span class="nc">some\package\UnexpectedValueException</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$c</span> <span class="k">instanceof</span> <span class="nc">SomeInterface</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="nc">UnexpectedValueException</span><span class="o">::</span><span class="nf">wrongType</span><span class="p">(</span><span class="nb">get_class</span><span class="p">(</span><span class="nv">$c</span><span class="p">),</span> <span class="nc">SomeInterface</span><span class="o">::</span><span class="n">class</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<h4 id="extended-exceptions-with-additional-details">Extended exceptions with additional details</h4>

<p>There are cases, when we need to perform additional actions in <code class="language-plaintext highlighter-rouge">catch</code> block. For that we often need to know the details about the original arguments, that caused the exception. For instance, you’re catching a <code class="language-plaintext highlighter-rouge">DuplicatedAccountException</code>, and want to know the e-mail, that was passed to a registration service. It might be quite easy, if the call to a service and the <code class="language-plaintext highlighter-rouge">catch</code> block are in the same context:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="kd">class</span> <span class="nc">DuplicatedAccountException</span> <span class="k">extends</span> <span class="err">\</span><span class="nc">LogicException</span> <span class="p">{}</span>

<span class="kd">class</span> <span class="nc">RegistrationService</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">register</span><span class="p">(</span><span class="nv">$email</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nc">DuplicatedAccountException</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">'Account with %s email alread exists.'</span><span class="p">,</span> <span class="nv">$email</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Calling code</span>
<span class="nv">$email</span> <span class="o">=</span> <span class="s1">'test@test.com'</span><span class="p">;</span>
<span class="nv">$registrationService</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RegistrationService</span><span class="p">();</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="nv">$registrationService</span><span class="o">-&gt;</span><span class="nf">register</span><span class="p">(</span><span class="nv">$email</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nc">DuplicatedAccountException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s1">'Error: '</span> <span class="mf">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="nf">getMessage</span><span class="p">()</span> <span class="mf">.</span> <span class="kc">PHP_EOL</span><span class="p">;</span>

    <span class="c1">// Do something else with $email. We can do that</span>
    <span class="c1">// because we are in the same context, i.e. in one method.</span>
<span class="p">}</span></code></pre></figure>

<p>But it is quite common, when you are catching an exception, that is thrown from some deeply nested method, and you don’t have access to the context. In this case, it is helpful to have this information <em>attached</em> to the exception itself.</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="kd">class</span> <span class="nc">DuplicatedAccountException</span> <span class="k">extends</span> <span class="err">\</span><span class="nc">LogicException</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$originalEmail</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span><span class="nv">$originalEmail</span><span class="p">,</span> <span class="nv">$code</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">Exception</span> <span class="nv">$previous</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">originalEmail</span> <span class="o">=</span> <span class="nv">$originalEmail</span><span class="p">;</span>

        <span class="k">parent</span><span class="o">::</span><span class="nf">__construct</span><span class="p">(</span>
            <span class="nb">sprintf</span><span class="p">(</span><span class="s1">'Account with %s email alread exists.'</span><span class="p">,</span> <span class="nv">$originalEmail</span><span class="p">),</span>
            <span class="nv">$code</span><span class="p">,</span>
            <span class="nv">$previous</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="n">create</span><span class="p">(</span><span class="nv">$originalEmail</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">self</span><span class="p">(</span><span class="nv">$originalEmail</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">getOriginalEmail</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">originalEmail</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Calling code</span>
<span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Some actions…</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nc">DuplicatedAccountException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Do something with $originalEmail.</span>
    <span class="k">echo</span> <span class="s1">'Original email: '</span> <span class="mf">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="nf">getOriginalEmail</span><span class="p">()</span> <span class="mf">.</span> <span class="kc">PHP_EOL</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>


	</section>
	<section id="share-page">
	<span>Share this page on</span>
	<a href="https://twitter.com/intent/tweet?text=A Few Notes on PHP Exceptions&url=https://guzalexander.com/2016/07/23/a-few-notes-on-php-exceptions.html&via=&related=" rel="nofollow" target="_blank" title="Share on Twitter">Twitter</a> or
	<a href="https://www.reddit.com/submit?url=https://guzalexander.com/2016/07/23/a-few-notes-on-php-exceptions.html&title=A Few Notes on PHP Exceptions" rel="nofollow" target="_blank" title="Share on Reddit">Reddit</a>
</section>

</article>


			</section>

			<footer class="main-footer">
				<section class="copyright">&copy; Copyright 2021 by Alexander Guz • <a target="_blank" href="/feed.xml">RSS</a></section>
				<section>Built with <a target="_blank" href="https://jekyllrb.com/">Jekyll</a></section>
			</footer>
		</section>
	</section>

	<script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-31916607-1']);
		_gaq.push(['_setDomainName', 'guzalexander.com']);
		_gaq.push(['_trackPageview']);

		(function () {
            var ga = document.createElement('script');ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' === document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga, s);
		})();
	</script>

</body>

</html>
