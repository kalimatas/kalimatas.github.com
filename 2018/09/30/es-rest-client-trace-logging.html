<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="/static/css/style.css" type="text/css" />
	<link rel="stylesheet" href="/static/css/pygments.css" type="text/css" />
	<link rel="icon" type="image/x-icon" href="/favicon.ico">
	<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Enabling Trace Logging for Elasticsearch REST Client with Logback | Alexander Guz’s blog</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Enabling Trace Logging for Elasticsearch REST Client with Logback" />
<meta name="author" content="Alexander Guz" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Recently I had some issues with Elasticsearch - all requests were failing with “bad request” error. In order to understand what was wrong with these requests, I, natually, decided to enable debug/trace logging of for ES REST Client, but couldn’t find out how. Partially, because the official documentation on this topic could have been more informative, to be honest. But mainly, because my project uses Logback and the REST Client package uses Apache Commons Logging." />
<meta property="og:description" content="Recently I had some issues with Elasticsearch - all requests were failing with “bad request” error. In order to understand what was wrong with these requests, I, natually, decided to enable debug/trace logging of for ES REST Client, but couldn’t find out how. Partially, because the official documentation on this topic could have been more informative, to be honest. But mainly, because my project uses Logback and the REST Client package uses Apache Commons Logging." />
<link rel="canonical" href="https://guzalexander.com/2018/09/30/es-rest-client-trace-logging.html" />
<meta property="og:url" content="https://guzalexander.com/2018/09/30/es-rest-client-trace-logging.html" />
<meta property="og:site_name" content="Alexander Guz’s blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-09-30T15:12:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Enabling Trace Logging for Elasticsearch REST Client with Logback" />
<meta name="twitter:site" content="@kalimatas" />
<meta name="twitter:creator" content="@Alexander Guz" />
<script type="application/ld+json">
{"headline":"Enabling Trace Logging for Elasticsearch REST Client with Logback","dateModified":"2018-09-30T15:12:00+02:00","datePublished":"2018-09-30T15:12:00+02:00","url":"https://guzalexander.com/2018/09/30/es-rest-client-trace-logging.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://guzalexander.com/2018/09/30/es-rest-client-trace-logging.html"},"author":{"@type":"Person","name":"Alexander Guz"},"description":"Recently I had some issues with Elasticsearch - all requests were failing with “bad request” error. In order to understand what was wrong with these requests, I, natually, decided to enable debug/trace logging of for ES REST Client, but couldn’t find out how. Partially, because the official documentation on this topic could have been more informative, to be honest. But mainly, because my project uses Logback and the REST Client package uses Apache Commons Logging.","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>

	<section class="container">
		<nav class="menu">
			<ul>
				<li><a class="nav-link fancy-hover" href="/"><span>Home</span></a></li>
				<li><a class="nav-link fancy-hover" href="/archive/"><span>Archive</span></a></li>
				<li><a class="nav-link fancy-hover" href="/about/"><span>About</span></a></li>
			</ul>
			<ul>
				<li>
					<a class="nav-link fancy-hover" href="https://twitter.com/kalimatas" target="_blank" >
						<span>
							<img alt="Twitter" width="18" height="18" title="Twitter" src="/static/img/twitter_new.svg" />
						</span>
					</a>
				</li>
				<li>
					<a class="nav-link fancy-hover" href="https://github.com/kalimatas" target="_blank">
						<span>
							<img alt="GitHub" width="18" height="18" title="GitHub" src="/static/img/github_new.svg" />
						</span>
					</a>
				</li>
				<li>
					<a class="nav-link fancy-hover" href="https://linkedin.com/in/kalimatas" target="_blank" >
						<span>
							<img alt="LinkedIn" width="18" height="18" title="LinkedIn" src="/static/img/linkedin_new.svg" />
						</span>
					</a>
				</li>
			</ul>
		</nav>

		<section class="main-wrapper">
			<section class="main">
				<article>
	
	<h1><span>Enabling Trace Logging for Elasticsearch REST Client with Logback</span></h1>
	<section class="post-meta">
		
		<time>September 30, 2018</time> • <span class="reading-time" title="Estimated read time">
  
  
    2 mins read
  
</span>

	</section>
	
	<section id="article-content">
		<p>Recently I had some issues with Elasticsearch - all requests were failing with “bad request” error. In order to understand what was wrong with these requests, I, natually, decided to enable debug/trace logging of for ES REST Client, but couldn’t find out how. Partially, because the <a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/6.3/java-rest-low-usage-logging.html">official documentation</a> on this topic could have been more informative, to be honest. But mainly, because my project uses <a href="https://logback.qos.ch/">Logback</a> and the REST Client package uses <a href="https://commons.apache.org/proper/commons-logging/">Apache Commons Logging</a>.</p>

<p>This article is a short summary of how I’ve eventually managed to enable tracing with Logback. The patient under inspection is  Elasticsearch 6.3 with its <a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/6.3/java-rest-low.html">Java Low Level REST Client</a>.</p>

<p>According to the official documentation, we need to enable trace logging for the <code>tracer</code> package. If you are interested, you can check the source code for <a href="https://github.com/elastic/elasticsearch/blob/v6.3/client/rest/src/main/java/org/elasticsearch/client/RequestLogger.java#L49">org.elasticsearch.client.RequestLogger</a> class, where the logger with this name is defined:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="o">...</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.logging.Log</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.logging.LogFactory</span><span class="o">;</span>
<span class="o">...</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Log</span> <span class="n">tracer</span> <span class="o">=</span> <span class="nc">LogFactory</span><span class="o">.</span><span class="na">getLog</span><span class="o">(</span><span class="s">"tracer"</span><span class="o">);</span>
<span class="o">...</span></code></pre></figure>

<p>As you can see, enabling this logger with <code>TRACE</code> level in Logback is not enough, because, again, the client uses Apache Commons Logging.</p>

<p>Luckily, Logback was designed with this use case in mind, and provides a set of bridging modules <sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote">1</a></sup>. They 
allow us to use Logback even with other dependencies that rely on other logging API. In particular, we’re looking for <a href="https://www.slf4j.org/legacy.html#jclOverSLF4J">jcl-over-slf4j.jar</a>.</p>

<p>So, here are the steps.</p>

<p><strong>Require <code>jcl-over-slf4j.jar</code></strong>. The dependencies section for Gradle:</p>

<figure class="highlight"><pre><code class="language-gradle" data-lang="gradle"><span class="k">dependencies</span> <span class="o">{</span>
    <span class="n">implementation</span><span class="o">(</span><span class="s1">'org.slf4j:slf4j-api:1.8.0-beta2'</span><span class="o">)</span>
    <span class="n">implementation</span><span class="o">(</span><span class="s1">'ch.qos.logback:logback-classic:1.3.0-alpha4'</span><span class="o">)</span>
    <span class="n">implementation</span><span class="o">(</span><span class="s1">'org.slf4j:jcl-over-slf4j:1.8.0-beta2'</span><span class="o">)</span>
<span class="o">}</span></code></pre></figure>

<p><strong>Exclude <code>commons-logging.jar</code></strong>. The details of why are described in the Logback docs <a href="https://www.slf4j.org/legacy.html#jclOverSLF4J">here</a>.</p>

<figure class="highlight"><pre><code class="language-gradle" data-lang="gradle"><span class="k">dependencies</span> <span class="o">{</span>
    <span class="n">configurations</span><span class="o">.</span><span class="na">all</span> <span class="o">{</span>
        <span class="n">exclude</span> <span class="nl">group:</span> <span class="s2">"commons-logging"</span><span class="o">,</span> <span class="nl">module:</span> <span class="s2">"commons-logging"</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p><strong>Enable <em>tracer</em> logger in Logback configuration.</strong></p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"STDOUT"</span> <span class="na">class=</span><span class="s">"ch.qos.logback.core.ConsoleAppender"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;encoder&gt;</span>
            <span class="nt">&lt;pattern&gt;</span>[%d{ISO8601}] [%thread] %-5level %logger{36} - %msg%n<span class="nt">&lt;/pattern&gt;</span>
        <span class="nt">&lt;/encoder&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="nt">&lt;root</span> <span class="na">level=</span><span class="s">"WARN"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"STDOUT"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/root&gt;</span>

    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"tracer"</span> <span class="na">level=</span><span class="s">"TRACE"</span> <span class="na">additivity=</span><span class="s">"false"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"STDOUT"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>

    <span class="c">&lt;!-- Additionally, you can also enable debug logging ofr RestClient class itself --&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"org.elasticsearch.client.RestClient"</span> <span class="na">level=</span><span class="s">"DEBUG"</span> <span class="na">additivity=</span><span class="s">"false"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"STDOUT"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>
<span class="nt">&lt;/configuration&gt;</span></code></pre></figure>

<p>Voilà! Enjoy your debugging session!</p>

<h2 id="notes">Notes</h2>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p><a href="https://www.slf4j.org/legacy.html">Bridging legacy APIs with Logback</a> <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

	</section>
	<section id="share-page">
	<span>Share this page on</span>
	<a href="https://twitter.com/intent/tweet?text=Enabling Trace Logging for Elasticsearch REST Client with Logback&url=https://guzalexander.com/2018/09/30/es-rest-client-trace-logging.html&via=&related=" rel="nofollow" target="_blank" title="Share on Twitter">Twitter</a> or
	<a href="https://www.reddit.com/submit?url=https://guzalexander.com/2018/09/30/es-rest-client-trace-logging.html&title=Enabling Trace Logging for Elasticsearch REST Client with Logback" rel="nofollow" target="_blank" title="Share on Reddit">Reddit</a>
</section>

</article>


			</section>

			<footer class="main-footer">
				<section class="copyright">&copy; Copyright 2021 by Alexander Guz • <a target="_blank" href="/feed.xml">RSS</a></section>
				<section>Built with <a target="_blank" href="https://jekyllrb.com/">Jekyll</a></section>
			</footer>
		</section>
	</section>

	<script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-31916607-1']);
		_gaq.push(['_setDomainName', 'guzalexander.com']);
		_gaq.push(['_trackPageview']);

		(function () {
            var ga = document.createElement('script');ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' === document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga, s);
		})();
	</script>

</body>

</html>
